<header>
  <div class="header-content">
    <h1>Neural Network Demo</h1>
    <p>Explore how neural networks work with MNIST digit classification</p>

    <!-- New Navigation Header -->
    <nav class="header-navigation">
      <div
        class="nav-section"
        [class.active]="activeSection === 'learn'"
        [class.clickable]="canNavigateToSection('learn')"
        (click)="canNavigateToSection('learn') && switchSection('learn')"
      >
        <span class="nav-number">1</span>
        <span class="nav-label">Learn About Neural Nets</span>
      </div>

      <div class="nav-arrow">
        <img src="assets/right-arrow.svg" alt="arrow" />
      </div>

      <div
        class="nav-section"
        [class.active]="activeSection === 'create'"
        [class.clickable]="canNavigateToSection('create')"
        (click)="canNavigateToSection('create') && switchSection('create')"
      >
        <span class="nav-number">2</span>
        <span class="nav-label">Create a Network</span>
      </div>

      <div class="nav-arrow">
        <img src="assets/right-arrow.svg" alt="arrow" />
      </div>

      <div
        class="nav-section"
        [class.active]="activeSection === 'train'"
        [class.clickable]="canNavigateToSection('train')"
        (click)="canNavigateToSection('train') && switchSection('train')"
      >
        <span class="nav-number">3</span>
        <span class="nav-label">Train a Network</span>
      </div>

      <div class="nav-arrow">
        <img src="/assets/right-arrow.svg" alt="arrow" />
      </div>

      <div
        class="nav-section"
        [class.active]="activeSection === 'test'"
        [class.clickable]="canNavigateToSection('test')"
        (click)="canNavigateToSection('test') && switchSection('test')"
      >
        <span class="nav-number">4</span>
        <span class="nav-label">Test the Network</span>
      </div>
    </nav>
  </div>
</header>

<div class="app-layout">
  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Learn About Neural Nets Section -->
    <section class="content-section" *ngIf="activeSection === 'learn'">
      <div class="section-header">
        <h2>Learn About Neural Networks</h2>
        <p>
          Understanding the basics of artificial neural networks and how they
          work
        </p>
      </div>

      <div class="learn-content">
        <div class="learn-card">
          <h3>What is a Neural Network?</h3>
          <p>
            A neural network is a computing system inspired by biological neural
            networks. It consists of interconnected nodes (neurons) organized in
            layers that process information.
          </p>
        </div>

        <div class="learn-card">
          <h3>How Does it Work?</h3>
          <p>
            Neural networks learn by adjusting connection weights between
            neurons based on training data. This process allows them to
            recognize patterns and make predictions.
          </p>
        </div>

        <div class="learn-card">
          <h3>MNIST Dataset</h3>
          <p>
            In this demo, we'll use the MNIST dataset - a collection of 70,000
            handwritten digits (0-9) commonly used for training image processing
            systems.
          </p>
        </div>

        <div class="learn-card">
          <h3>Network Architecture</h3>
          <p>
            Our network will have an input layer (784 neurons for 28x28 pixel
            images), hidden layers for processing, and an output layer (10
            neurons for digits 0-9).
          </p>
        </div>
      </div>

      <div class="section-actions">
        <button class="continue-button" (click)="continueToCreate()">
          Continue to Create Network
        </button>
      </div>
    </section>

    <!-- Create Network Section -->
    <section class="content-section" *ngIf="activeSection === 'create'">
      <div class="section-header">
        <h2>Create a Network</h2>
        <p>Configure your neural network architecture</p>
      </div>

      <div class="create-content">
        <div class="config-panel">
          <h3>Configure Network Architecture</h3>
          <div class="layer-config">
            <div class="layer-item">
              <label>
                <span>Hidden Layer 1 Size:</span>
                <input
                  type="number"
                  [(ngModel)]="hiddenLayer1"
                  min="1"
                  max="1000"
                  (change)="previewNetworkStructure()"
                />
              </label>
            </div>

            <div class="layer-item">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="useSecondLayer"
                  (change)="previewNetworkStructure()"
                />
                <span>Use Second Hidden Layer</span>
              </label>
            </div>

            <div class="layer-item" *ngIf="useSecondLayer">
              <label>
                <span>Hidden Layer 2 Size:</span>
                <input
                  type="number"
                  [(ngModel)]="hiddenLayer2"
                  min="1"
                  max="1000"
                  (change)="previewNetworkStructure()"
                />
              </label>
            </div>
          </div>

          <div class="network-preview">
            <h4>Network Structure Preview:</h4>
            <div class="layer-preview">
              <span class="layer-size">Input: 784</span>
              <span class="arrow">→</span>
              <span class="layer-size">Hidden: {{ hiddenLayer1 }}</span>
              <span class="arrow" *ngIf="useSecondLayer">→</span>
              <span class="layer-size" *ngIf="useSecondLayer"
                >Hidden: {{ hiddenLayer2 }}</span
              >
              <span class="arrow">→</span>
              <span class="layer-size">Output: 10</span>
            </div>
          </div>

          <button
            class="create-network-button"
            (click)="createNetwork()"
            [disabled]="loading"
          >
            {{ loading ? "Creating..." : "Create Network" }}
          </button>
        </div>
      </div>
    </section>

    <!-- Train Network Section -->
    <section class="content-section" *ngIf="activeSection === 'train'">
      <div class="section-header">
        <h2>Train the Network</h2>
        <p>Configure training parameters and start the learning process</p>
      </div>

      <div class="train-content">
        <div class="training-config" *ngIf="!trainingStarted">
          <h3>Training Parameters</h3>
          <div class="param-grid">
            <div class="param-item">
              <label>
                <span>Epochs:</span>
                <input type="number" [(ngModel)]="epochs" min="1" max="100" />
              </label>
            </div>
            <div class="param-item">
              <label>
                <span>Mini-batch Size:</span>
                <input
                  type="number"
                  [(ngModel)]="miniBatchSize"
                  min="1"
                  max="100"
                />
              </label>
            </div>
            <div class="param-item">
              <label>
                <span>Learning Rate:</span>
                <input
                  type="number"
                  [(ngModel)]="learningRate"
                  step="0.1"
                  min="0.1"
                  max="10"
                />
              </label>
            </div>
          </div>

          <button
            class="start-training-button"
            (click)="startTraining()"
            [disabled]="trainingLoading || !networkId"
          >
            {{ trainingLoading ? "Starting..." : "Start Training" }}
          </button>
        </div>

        <div class="training-progress" *ngIf="trainingStarted">
          <h3>Training Progress</h3>
          <div class="progress-info" *ngIf="currentTraining">
            <div class="progress-stat">
              <label>Epoch:</label>
              <span
                >{{ currentTraining.epoch }} /
                {{ currentTraining.total_epochs }}</span
              >
            </div>

            <div class="progress-bar">
              <div
                class="progress-fill"
                [style.width.%]="currentTraining.progress"
              ></div>
            </div>

            <div class="progress-stats">
              <div class="stat">
                <label>Accuracy:</label>
                <span>{{ (currentTraining.accuracy * 100).toFixed(2) }}%</span>
              </div>
              <div class="stat">
                <label>Correct:</label>
                <span
                  >{{ currentTraining.correct }} /
                  {{ currentTraining.total }}</span
                >
              </div>
              <div class="stat">
                <label>Time:</label>
                <span>{{ currentTraining.elapsed_time.toFixed(1) }}s</span>
              </div>
            </div>
          </div>

          <div class="training-complete" *ngIf="trainingComplete">
            <h4>Training Complete!</h4>
            <p>Final Accuracy: {{ (finalAccuracy! * 100).toFixed(2) }}%</p>
            <button class="continue-button" (click)="continueToTest()">
              Continue to Test Network
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Test Network Section -->
    <section class="content-section" *ngIf="activeSection === 'test'">
      <div class="section-header">
        <h2>Test the Network</h2>
        <p>Try your trained network with test examples</p>
      </div>

      <div class="test-content">
        <div class="test-controls">
          <button
            class="test-button"
            (click)="getRandomExample()"
            [disabled]="loadingExample"
          >
            {{ loadingExample ? "Loading..." : "Get Random Test Example" }}
          </button>

          <button
            class="test-button secondary"
            (click)="showExamples = !showExamples"
          >
            {{ showExamples ? "Hide" : "Show" }} Success/Failure Examples
          </button>
        </div>

        <div class="test-result" *ngIf="currentExample">
          <div class="example-display">
            <div class="example-image">
              <h4>Test Image:</h4>
              <img
                [src]="currentExample.image_data"
                alt="Test digit"
                (load)="imageLoaded = true"
                (error)="imageLoaded = false"
              />
              <div *ngIf="!imageLoaded" class="fallback-image">
                <img src="assets/fallback-digit.png" alt="Fallback digit" />
              </div>
            </div>

            <div class="prediction-result">
              <h4>Prediction Results:</h4>
              <div class="result-item">
                <label>Actual Label:</label>
                <span class="actual-label">{{
                  currentExample.actual_label
                }}</span>
              </div>
              <div class="result-item">
                <label>Predicted:</label>
                <span
                  class="predicted-label"
                  [class.correct]="
                    currentExample.predicted_label ===
                    currentExample.actual_label
                  "
                  [class.incorrect]="
                    currentExample.predicted_label !==
                    currentExample.actual_label
                  "
                >
                  {{ currentExample.predicted_label }}
                </span>
              </div>
              <div class="result-item">
                <label>Confidence:</label>
                <span class="confidence"
                  >{{ (currentExample.confidence * 100).toFixed(1) }}%</span
                >
              </div>
              <div class="result-status">
                <span
                  class="status"
                  [class.success]="
                    currentExample.predicted_label ===
                    currentExample.actual_label
                  "
                  [class.failure]="
                    currentExample.predicted_label !==
                    currentExample.actual_label
                  "
                >
                  {{
                    currentExample.predicted_label ===
                    currentExample.actual_label
                      ? "✓ Correct"
                      : "✗ Incorrect"
                  }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Success/Failure Examples Section -->
        <div class="examples-section" *ngIf="showExamples">
          <div class="examples-grid">
            <!-- Success Examples -->
            <div class="example-category">
              <h4>Successful Classifications</h4>
              <div class="example-list">
                <div
                  class="mini-example"
                  *ngFor="let example of successExamples"
                >
                  <img [src]="example.image_data" alt="Success example" />
                  <div class="mini-label">
                    {{ example.actual_label }} → {{ example.predicted_label }}
                    <span class="confidence"
                      >({{ (example.confidence * 100).toFixed(0) }}%)</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Failure Examples -->
            <div class="example-category">
              <h4>Failed Classifications</h4>
              <div class="example-list">
                <div
                  class="mini-example"
                  *ngFor="let example of failureExamples"
                >
                  <img [src]="example.image_data" alt="Failure example" />
                  <div class="mini-label error">
                    {{ example.actual_label }} → {{ example.predicted_label }}
                    <span class="confidence"
                      >({{ (example.confidence * 100).toFixed(0) }}%)</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
