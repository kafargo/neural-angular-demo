<div class="training-section" *ngIf="networkId">
  <!-- WebSocket Connection Status -->
  <div
    class="websocket-status"
    [ngClass]="{ connected: connectionStatus.connected }"
  >
    <span
      *ngIf="connectionStatus.connected; else disconnected"
      class="status-text"
    >
      ðŸŸ¢ Real-time updates active (ID:
      {{ connectionStatus.socketId?.substring(0, 6) }})
    </span>
    <ng-template #disconnected>
      <span class="status-text"
        >ðŸ”´ Real-time updates not available, using polling</span
      >
      <button (click)="reconnectWebSocket()" class="btn-reconnect">
        Reconnect
      </button>
    </ng-template>
  </div>

  <div *ngIf="!trainingStarted" class="training-config">
    <h3>Train Your Network</h3>
    <p>Train your neural network on the MNIST dataset:</p>

    <div class="training-params">
      <div class="param-item">
        <label>
          <span>Epochs:</span>
          <input type="number" [(ngModel)]="epochs" min="1" max="50" />
        </label>
        <span class="param-hint"
          >Number of complete passes through the training data</span
        >
      </div>

      <div class="param-item">
        <label>
          <span>Mini Batch Size:</span>
          <input type="number" [(ngModel)]="miniBatchSize" min="1" max="100" />
        </label>
        <span class="param-hint">Number of examples processed together</span>
      </div>

      <div class="param-item">
        <label>
          <span>Learning Rate:</span>
          <input
            type="number"
            [(ngModel)]="learningRate"
            min="0.1"
            max="10"
            step="0.1"
          />
        </label>
        <span class="param-hint">Step size for gradient descent</span>
      </div>
    </div>

    <button (click)="startTraining()" [disabled]="loading" class="train-button">
      {{ loading ? "Starting Training..." : "Start Training" }}
    </button>
  </div>

  <div *ngIf="trainingStarted && !trainingComplete" class="training-progress">
    <h3>Training in Progress</h3>
    <div class="progress-container">
      <div class="progress-bar" [style.width.%]="trainingProgress"></div>
    </div>

    <!-- Standard training details -->
    <div
      *ngIf="!currentTraining && connectionStatus.connected === false"
      class="progress-details"
    >
      <span>{{ trainingProgress }}% Complete</span>
      <span *ngIf="currentAccuracy"
        >Current Accuracy: {{ currentAccuracy | percent : "1.1-1" }}</span
      >
    </div>

    <!-- Enhanced WebSocket training details -->
    <div *ngIf="currentTraining" class="enhanced-progress-details">
      <div class="training-detail-row">
        <span class="detail-label">Progress:</span>
        <span class="detail-value">{{ trainingProgress }}%</span>
      </div>

      <div class="training-detail-row">
        <span class="detail-label">Epoch:</span>
        <span class="detail-value"
          >{{ currentTraining.epoch }} /
          {{ currentTraining.total_epochs }}</span
        >
      </div>

      <div
        class="training-detail-row"
        *ngIf="currentTraining.accuracy !== null"
      >
        <span class="detail-label">Accuracy:</span>
        <span class="detail-value"
          >{{ (currentTraining.accuracy * 100).toFixed(2) }}%</span
        >
      </div>

      <div
        class="training-detail-row"
        *ngIf="currentTraining.correct && currentTraining.total"
      >
        <span class="detail-label">Correct/Total:</span>
        <span class="detail-value"
          >{{ currentTraining.correct }} / {{ currentTraining.total }}</span
        >
      </div>

      <div class="training-detail-row">
        <span class="detail-label">Time (this epoch):</span>
        <span class="detail-value"
          >{{ currentTraining.elapsed_time.toFixed(2) }}s</span
        >
      </div>
    </div>
  </div>

  <div *ngIf="trainingComplete" class="training-complete">
    <h3>Training Complete!</h3>
    <div class="training-results">
      <div class="result-item">
        <div class="result-label">Final Accuracy:</div>
        <div class="result-value">{{ finalAccuracy | percent : "1.1-1" }}</div>
      </div>
      <div class="result-item">
        <div class="result-label">Epochs Completed:</div>
        <div class="result-value">{{ epochs }}</div>
      </div>
    </div>

    <div class="action-buttons">
      <button (click)="showExamples()" class="test-button">
        Test with Examples
      </button>
    </div>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>
</div>
